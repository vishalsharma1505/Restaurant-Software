{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Products</h3>
    <a href="{{ url_for('add_product') }}" class="btn btn-primary">âž• Add Product</a>
  </div>

  <!-- ðŸ”¹ Filter & Sort -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
      <select name="category_id" class="form-select" onchange="this.form.submit()">
        <option value="">All Categories</option>
        {% for cat in categories %}
          <option value="{{ cat.id }}" {% if category_id|string == cat.id|string %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <select name="sort_by" class="form-select" onchange="this.form.submit()">
        <option value="name_asc" {% if sort_by == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
        <option value="name_desc" {% if sort_by == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
        <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>Price (Low â†’ High)</option>
        <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>Price (High â†’ Low)</option>
        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest</option>
      </select>
    </div>
  </form>

  <!-- ðŸ”¹ Product Table -->
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Image</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products.items %}
      <tr>
        <td>{{ product.id }}</td>
        <td>{{ product.name }}</td>
        <td>{{ product.category.name if product.category else '' }}</td>
        <td>â‚¹{{ "%.2f"|format(product.price) }}</td>
        <td>
          {% if product.image %}
            <img src="{{ url_for('static', filename='images/' + product.image) }}" width="50" class="rounded">
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('edit_product', id=product.id) }}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{{ url_for('delete_product', id=product.id) }}" class="btn btn-sm btn-danger"
             onclick="return confirm('Are you sure?')">Delete</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- ðŸ”¹ Pagination -->
  <nav>
    <ul class="pagination">
      {% if products.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('admin_products', page=products.prev_num, category_id=category_id, sort_by=sort_by) }}">Previous</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      {% for p in products.iter_pages() %}
        {% if p %}
          <li class="page-item {% if products.page == p %}active{% endif %}">
            <a class="page-link" href="{{ url_for('admin_products', page=p, category_id=category_id, sort_by=sort_by) }}">{{ p }}</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">â€¦</span></li>
        {% endif %}
      {% endfor %}

      {% if products.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('admin_products', page=products.next_num, category_id=category_id, sort_by=sort_by) }}">Next</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
